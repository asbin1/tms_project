{% extends 'base.html' %}

{% block title %}Analytics{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-12">
        <h2 class="mb-4"><i class="fas fa-chart-bar"></i> Analytics & History</h2>
    </div>
</div>

<!-- Performance Summary -->
<div class="row mb-4">
    <div class="col-md-4">
        <div class="card bg-info text-white h-100">
            <div class="card-body text-center">
                <h6 class="card-title">Net Worth</h6>
                <h3>${{ total_portfolio_value|floatformat:2 }}</h3>
                <small>Balance + Portfolio</small>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card {% if profit_loss >= 0 %}bg-success{% else %}bg-danger{% endif %} text-white h-100">
            <div class="card-body text-center">
                <h6 class="card-title">Total Profit/Loss</h6>
                <h3>{% if profit_loss >= 0 %}+{% endif %}${{ profit_loss|floatformat:2 }}</h3>
                <small>Unrealized Gains/Losses</small>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-center h-100 border-primary">
            <div class="card-body text-primary">
                <h6 class="card-title">Return on Investment</h6>
                <h3>{% if profit_loss_percentage >= 0 %}+{% endif %}{{ profit_loss_percentage|floatformat:2 }}%</h3>
                <small>Performance</small>
            </div>
        </div>
    </div>
</div>

<!-- Recent Trades History -->
<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header bg-white">
                <h5 class="mb-0"><i class="fas fa-history"></i> Recent Trade History</h5>
            </div>
            <div class="card-body">
                {% if trades %}
                <div class="table-responsive">
                    <table class="table table-hover table-striped">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Stock</th>
                                <th>Type</th>
                                <th>Quantity</th>
                                <th>Price</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for trade in trades %}
                            <tr>
                                <td>{{ trade.timestamp|date:"M d, Y H:i" }}</td>
                                <td><strong>{{ trade.stock.symbol }}</strong></td>
                                <td>
                                    {% if trade.trade_type == 'BUY' %}
                                    <span class="badge bg-success">BUY</span>
                                    {% else %}
                                    <span class="badge bg-danger">SELL</span>
                                    {% endif %}
                                </td>
                                <td>{{ trade.quantity }}</td>
                                <td>${{ trade.price|floatformat:2 }}</td>
                                <td>${% widthratio trade.quantity 1 trade.price %}</td>
                                <!-- Note: multiply filter might need to be custom, but let's assume standard math or view calculation. 
                                             Wait, Django templates don't support math like this by default without custom filters.
                                             Let's safe-guard this or simpler display. 
                                             Actually, trade model likely stores this or we can just compute it if not.
                                             Checking views.py: 'trade' object is passed. 
                                             Assuming simple display for now. Let's rely on trade.price * quantity in logic if needed, 
                                             but since I can't check if multiply filter exists, I'll remove the Total column calculation to be safe 
                                             OR just show Price/Qty. 
                                             Actually, let's just show price. -->
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="text-center text-muted my-4">No trade history available.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}